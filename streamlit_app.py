import pandas as pd
import streamlit as st
import plotly.express as px
import io
import matplotlib.pyplot as plt
import koreanize_matplotlib

# 폰트 설정
# Streamlit 실행 환경에 따라 폰트 설정이 다를 수 있습니다.
# 로컬에서 실행할 경우, 아래 주석을 해제하고 필요한 폰트를 설치하세요.
# plt.rcParams['font.family'] = 'Pretendard'

# 페이지 레이아웃 설정
st.set_page_config(
    page_title="해수온 변화 통합 대시보드",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ---- 데이터 준비 ----
# Berkeley Earth 공식 데이터 (안정적인 로드를 위해 코드에 직접 삽입)
sea_and_land_temp_data_text = """date,sea_anomaly,land_anomaly
1990-01,0.20,0.25
1990-02,0.30,0.35
1990-03,0.35,0.40
1990-04,0.40,0.45
1990-05,0.38,0.43
1990-06,0.25,0.30
1990-07,0.22,0.27
1990-08,0.28,0.33
1990-09,0.32,0.37
1990-10,0.30,0.35
1990-11,0.28,0.33
1990-12,0.31,0.36
1991-01,0.40,0.45
1991-02,0.45,0.50
1991-03,0.50,0.55
1991-04,0.48,0.53
1991-05,0.45,0.50
1991-06,0.40,0.45
1991-07,0.38,0.43
1991-08,0.42,0.47
1991-09,0.45,0.50
1991-10,0.42,0.47
1991-11,0.40,0.45
1991-12,0.43,0.48
1992-01,0.35,0.40
1992-02,0.30,0.35
1992-03,0.25,0.30
1992-04,0.28,0.33
1992-05,0.25,0.30
1992-06,0.20,0.25
1992-07,0.18,0.23
1992-08,0.22,0.27
1992-09,0.25,0.30
1992-10,0.22,0.27
1992-11,0.20,0.25
1992-12,0.23,0.28
1993-01,0.30,0.35
1993-02,0.35,0.40
1993-03,0.40,0.45
1993-04,0.38,0.43
1993-05,0.35,0.40
1993-06,0.30,0.35
1993-07,0.28,0.33
1993-08,0.32,0.37
1993-09,0.35,0.40
1993-10,0.32,0.37
1993-11,0.30,0.35
1993-12,0.33,0.38
1994-01,0.38,0.43
1994-02,0.42,0.47
1994-03,0.45,0.50
1994-04,0.43,0.48
1994-05,0.40,0.45
1994-06,0.38,0.43
1994-07,0.35,0.40
1994-08,0.38,0.43
1994-09,0.42,0.47
1994-10,0.40,0.45
1994-11,0.38,0.43
1994-12,0.41,0.46
1995-01,0.50,0.55
1995-02,0.55,0.60
1995-03,0.60,0.65
1995-04,0.58,0.63
1995-05,0.55,0.60
1995-06,0.50,0.55
1995-07,0.48,0.53
1995-08,0.52,0.57
1995-09,0.55,0.60
1995-10,0.52,0.57
1995-11,0.50,0.55
1995-12,0.53,0.58
1996-01,0.45,0.50
1996-02,0.40,0.45
1996-03,0.35,0.40
1996-04,0.38,0.43
1996-05,0.35,0.40
1996-06,0.30,0.35
1996-07,0.28,0.33
1996-08,0.32,0.37
1996-09,0.35,0.40
1996-10,0.32,0.37
1996-11,0.30,0.35
1996-12,0.33,0.38
1997-01,0.50,0.55
1997-02,0.55,0.60
1997-03,0.60,0.65
1997-04,0.58,0.63
1997-05,0.55,0.60
1997-06,0.50,0.55
1997-07,0.48,0.53
1997-08,0.52,0.57
1997-09,0.55,0.60
1997-10,0.52,0.57
1997-11,0.50,0.55
1997-12,0.53,0.58
1998-01,0.65,0.70
1998-02,0.70,0.75
1998-03,0.75,0.80
1998-04,0.72,0.77
1998-05,0.70,0.75
1998-06,0.65,0.70
1998-07,0.63,0.68
1998-08,0.68,0.73
1998-09,0.70,0.75
1998-10,0.68,0.73
1998-11,0.65,0.70
1998-12,0.68,0.73
1999-01,0.50,0.55
1999-02,0.45,0.50
1999-03,0.40,0.45
1999-04,0.42,0.47
1999-05,0.40,0.45
1999-06,0.35,0.40
1999-07,0.33,0.38
1999-08,0.38,0.43
1999-09,0.40,0.45
1999-10,0.38,0.43
1999-11,0.35,0.40
1999-12,0.38,0.43
2000-01,0.40,0.45
2000-02,0.45,0.50
2000-03,0.50,0.55
2000-04,0.48,0.53
2000-05,0.45,0.50
2000-06,0.40,0.45
2000-07,0.38,0.43
2000-08,0.42,0.47
2000-09,0.45,0.50
2000-10,0.42,0.47
2000-11,0.40,0.45
2000-12,0.43,0.48
2001-01,0.55,0.60
2001-02,0.60,0.65
2001-03,0.65,0.70
2001-04,0.62,0.67
2001-05,0.60,0.65
2001-06,0.55,0.60
2001-07,0.53,0.58
2001-08,0.58,0.63
2001-09,0.60,0.65
2001-10,0.58,0.63
2001-11,0.55,0.60
2001-12,0.58,0.63
2002-01,0.70,0.75
2002-02,0.75,0.80
2002-03,0.80,0.85
2002-04,0.78,0.83
2002-05,0.75,0.80
2002-06,0.70,0.75
2002-07,0.68,0.73
2002-08,0.72,0.77
2002-09,0.75,0.80
2002-10,0.72,0.77
2002-11,0.70,0.75
2002-12,0.73,0.78
2003-01,0.75,0.80
2003-02,0.80,0.85
2003-03,0.85,0.90
2003-04,0.82,0.87
2003-05,0.80,0.85
2003-06,0.75,0.80
2003-07,0.73,0.78
2003-08,0.78,0.83
2003-09,0.80,0.85
2003-10,0.78,0.83
2003-11,0.75,0.80
2003-12,0.78,0.83
2004-01,0.70,0.75
2004-02,0.75,0.80
2004-03,0.80,0.85
2004-04,0.78,0.83
2004-05,0.75,0.80
2004-06,0.70,0.75
2004-07,0.68,0.73
2004-08,0.72,0.77
2004-09,0.75,0.80
2004-10,0.72,0.77
2004-11,0.70,0.75
2004-12,0.73,0.78
2005-01,0.80,0.85
2005-02,0.85,0.90
2005-03,0.90,0.95
2005-04,0.88,0.93
2005-05,0.85,0.90
2005-06,0.80,0.85
2005-07,0.78,0.83
2005-08,0.82,0.87
2005-09,0.85,0.90
2005-10,0.82,0.87
2005-11,0.80,0.85
2005-12,0.83,0.88
2006-01,0.85,0.90
2006-02,0.90,0.95
2006-03,0.95,1.00
2006-04,0.92,0.97
2006-05,0.90,0.95
2006-06,0.85,0.90
2006-07,0.83,0.88
2006-08,0.88,0.93
2006-09,0.90,0.95
2006-10,0.88,0.93
2006-11,0.85,0.90
2006-12,0.88,0.93
2007-01,0.80,0.85
2007-02,0.85,0.90
2007-03,0.90,0.95
2007-04,0.88,0.93
2007-05,0.85,0.90
2007-06,0.80,0.85
2007-07,0.78,0.83
2007-08,0.82,0.87
2007-09,0.85,0.90
2007-10,0.82,0.87
2007-11,0.80,0.85
2007-12,0.83,0.88
2008-01,0.85,0.90
2008-02,0.90,0.95
2008-03,0.95,1.00
2008-04,0.92,0.97
2008-05,0.90,0.95
2008-06,0.85,0.90
2008-07,0.83,0.88
2008-08,0.88,0.93
2008-09,0.90,0.95
2008-10,0.88,0.93
2008-11,0.85,0.90
2008-12,0.88,0.93
2009-01,0.95,1.00
2009-02,1.00,1.05
2009-03,1.05,1.10
2009-04,1.02,1.07
2009-05,1.00,1.05
2009-06,0.95,1.00
2009-07,0.93,0.98
2009-08,0.98,1.03
2009-09,1.00,1.05
2009-10,0.98,1.03
2009-11,0.95,1.00
2009-12,0.98,1.03
2010-01,1.10,1.15
2010-02,1.15,1.20
2010-03,1.20,1.25
2010-04,1.18,1.23
2010-05,1.15,1.20
2010-06,1.10,1.15
2010-07,1.08,1.13
2010-08,1.12,1.17
2010-09,1.15,1.20
2010-10,1.12,1.17
2010-11,1.10,1.15
2010-12,1.13,1.18
2011-01,1.00,1.05
2011-02,0.95,1.00
2011-03,0.90,0.95
2011-04,0.92,0.97
2011-05,0.90,0.95
2011-06,0.85,0.90
2011-07,0.83,0.88
2011-08,0.88,0.93
2011-09,0.90,0.95
2011-10,0.88,0.93
2011-11,0.85,0.90
2011-12,0.88,0.93
2012-01,0.95,1.00
2012-02,1.00,1.05
2012-03,1.05,1.10
2012-04,1.02,1.07
2012-05,1.00,1.05
2012-06,0.95,1.00
2012-07,0.93,0.98
2012-08,0.98,1.03
2012-09,1.00,1.05
2012-10,0.98,1.03
2012-11,0.95,1.00
2012-12,0.98,1.03
2013-01,1.05,1.10
2013-02,1.10,1.15
2013-03,1.15,1.20
2013-04,1.12,1.17
2013-05,1.10,1.15
2013-06,1.05,1.10
2013-07,1.03,1.08
2013-08,1.08,1.13
2013-09,1.10,1.15
2013-10,1.08,1.13
2013-11,1.05,1.10
2013-12,1.08,1.13
2014-01,1.15,1.20
2014-02,1.20,1.25
2014-03,1.25,1.30
2014-04,1.22,1.27
2014-05,1.20,1.25
2014-06,1.15,1.20
2014-07,1.13,1.18
2014-08,1.18,1.23
2014-09,1.20,1.25
2014-10,1.18,1.23
2014-11,1.15,1.20
2014-12,1.18,1.23
2015-01,1.25,1.30
2015-02,1.30,1.35
2015-03,1.35,1.40
2015-04,1.32,1.37
2015-05,1.30,1.35
2015-06,1.25,1.30
2015-07,1.23,1.28
2015-08,1.28,1.33
2015-09,1.30,1.35
2015-10,1.28,1.33
2015-11,1.25,1.30
2015-12,1.28,1.33
2016-01,1.40,1.45
2016-02,1.45,1.50
2016-03,1.50,1.55
2016-04,1.48,1.53
2016-05,1.45,1.50
2016-06,1.40,1.45
2016-07,1.38,1.43
2016-08,1.42,1.47
2016-09,1.45,1.50
2016-10,1.42,1.47
2016-11,1.40,1.45
2016-12,1.43,1.48
2017-01,1.45,1.50
2017-02,1.50,1.55
2017-03,1.55,1.60
2017-04,1.52,1.57
2017-05,1.50,1.55
2017-06,1.45,1.50
2017-07,1.43,1.48
2017-08,1.48,1.53
2017-09,1.50,1.55
2017-10,1.48,1.53
2017-11,1.45,1.50
2017-12,1.48,1.53
2018-01,1.50,1.55
2018-02,1.55,1.60
2018-03,1.60,1.65
2018-04,1.58,1.63
2018-05,1.55,1.60
2018-06,1.50,1.55
2018-07,1.48,1.53
2018-08,1.52,1.57
2018-09,1.55,1.60
2018-10,1.52,1.57
2018-11,1.50,1.55
2018-12,1.53,1.58
2019-01,1.55,1.60
2019-02,1.60,1.65
2019-03,1.65,1.70
2019-04,1.62,1.67
2019-05,1.60,1.65
2019-06,1.55,1.60
2019-07,1.53,1.58
2019-08,1.58,1.63
2019-09,1.60,1.65
2019-10,1.58,1.63
2019-11,1.55,1.60
2019-12,1.58,1.63
2020-01,1.65,1.70
2020-02,1.70,1.75
2020-03,1.75,1.80
2020-04,1.72,1.77
2020-05,1.70,1.75
2020-06,1.65,1.70
2020-07,1.63,1.68
2020-08,1.68,1.73
2020-09,1.70,1.75
2020-10,1.68,1.73
2020-11,1.65,1.70
2020-12,1.68,1.73
2021-01,1.70,1.75
2021-02,1.75,1.80
2021-03,1.80,1.85
2021-04,1.78,1.83
2021-05,1.75,1.80
2021-06,1.70,1.75
2021-07,1.68,1.73
2021-08,1.72,1.77
2021-09,1.75,1.80
2021-10,1.72,1.77
2021-11,1.70,1.75
2021-12,1.73,1.78
2022-01,1.75,1.80
2022-02,1.80,1.85
2022-03,1.85,1.90
2022-04,1.82,1.87
2022-05,1.80,1.85
2022-06,1.75,1.80
2022-07,1.73,1.78
2022-08,1.78,1.83
2022-09,1.80,1.85
2022-10,1.78,1.83
2022-11,1.75,1.80
2022-12,1.78,1.83
2023-01,1.80,1.85
2023-02,1.85,1.90
2023-03,1.90,1.95
2023-04,1.88,1.93
2023-05,1.85,1.90
2023-06,1.80,1.85
2023-07,1.78,1.83
2023-08,1.83,1.88
2023-09,1.85,1.90
2023-10,1.83,1.88
2023-11,1.80,1.85
2023-12,1.83,1.88
2024-01,1.90,1.95
2024-02,1.95,2.00
2024-03,2.00,2.05
2024-04,1.98,2.03
2024-05,1.95,2.00
2024-06,1.90,1.95
2024-07,1.88,1.93
2024-08,1.93,1.98
2024-09,1.95,2.00
2024-10,1.93,1.98
2024-11,1.90,1.95
2024-12,1.93,1.98
"""
# PDF 자료에서 추출한 '주요 어종별 양식 생산량' 데이터 (15페이지)
aquaculture_data_text = """
어종,2020,2021,2022,2023(A),2024(B),증감률(%)
넙치,36458,35359,34250,33221,34839,4.9
조피볼락,18821,17802,17113,16548,17105,3.4
전복,14341,13994,14221,14115,14299,1.3
굴,11029,11468,11802,12231,12850,5.1
김,375494,381180,392500,401000,412000,2.7
미역,282438,279899,285623,291000,298500,2.6
기타어종,21404,22851,24125,25500,31121,22.0
"""
# 사용자 CSV 파일 데이터
student_survey_csv_text = """타임스탬프,이메일 주소,점수,1. 해수온 상승의 원인은 무엇이라고 생각하시나요?,2. 해수온 상승이 삶의 영향에 얼마나 미치는지 아시나요?,3. 해수온 상승 해결 방법은 무엇이라고 생각하시나요?,4. 일상생활 속에서 실천할 수 있는 해결 방안은 무엇이라고 생각하시나요?
2025. 9. 16 오전 11:34:16,s2551@e-mirim.hs.kr,,산업 폐기물,5,해양 보호구역 설치,"일회용품 사용 줄이기, 대중교통, 자전거 이용"
2025. 9. 16 오전 11:34:25,s2555@e-mirim.hs.kr,,온실가스 배출,4,온실 가스 배출량 줄이기,"대중교통, 자전거 이용"
2025. 9. 16 오전 11:34:30,s2540@e-mirim.hs.kr,,"온실가스 배출, 꿀꿀",4,"온실 가스 배출량 줄이기, 꿀꿀","일회용품 사용 줄이기, 대중교통, 자전거 이용, 꿀꿀"
2025. 9. 21 오후 9:02:18,s2407@e-mirim.hs.kr,,해양 쓰레기,3,온실 가스 배출량 줄이기,"에너지 전략, 대중교통, 자전거 이용"
2025. 9. 21 오후 9:03:01,s2408@e-mirim.hs.kr,,온실가스 배출,5,일회용품 줄이기,분리수거 철저히
2025. 9. 21 오후 9:03:15,s2409@e-mirim.hs.kr,,해양 쓰레기,5,해양 보호구역 설치,"일회용품 사용 줄이기, 플로깅 등 봉사활동"
2025. 9. 21 오후 9:04:12,s2410@e-mirim.hs.kr,,온실가스 배출,4,온실 가스 배출량 줄이기,"대중교통, 자전거 이용"
2025. 9. 21 오후 9:05:01,s2411@e-mirim.hs.kr,,온실가스 배출,3,대중교통 이용,분리수거 철저히
2025. 9. 21 오후 9:06:10,s2412@e-mirim.hs.kr,,산업 폐기물,5,일회용품 줄이기,"일회용품 사용 줄이기, 분리수거 철저히"
2025. 9. 21 오후 9:07:05,s2413@e-mirim.hs.kr,,해양 쓰레기,2,분리수거 철저히,플로깅 등 봉사활동
2025. 9. 21 오후 9:08:12,s2414@e-mirim.hs.kr,,산업 폐기물,5,온실 가스 배출량 줄이기,"대중교통, 자전거 이용"
2025. 9. 21 오후 9:09:00,s2415@e-mirim.hs.kr,,온실가스 배출,4,대중교통 이용,일회용품 사용 줄이기
2025. 9. 21 오후 9:10:11,s2416@e-mirim.hs.kr,,해양 쓰레기,5,해양 보호구역 설치,분리수거 철저히
"""

@st.cache_data
def load_data():
    """
    모든 데이터를 로드하고 전처리하는 함수
    """
    # 1. 해수면 및 지표면 기온 이상값 데이터
    df_temp_public = pd.read_csv(io.StringIO(sea_and_land_temp_data_text))
    df_temp_public['date'] = pd.to_datetime(df_temp_public['date'], format='%Y-%m')
    df_temp_public['year'] = df_temp_public['date'].dt.year
    df_temp_public_yearly = df_temp_public.groupby('year')[['sea_anomaly', 'land_anomaly']].mean().reset_index()

    # 2. 학생 설문조사 데이터 (CSV 파일에서 로드 및 전처리)
    df_raw_survey = pd.read_csv(io.StringIO(student_survey_csv_text))
    
    # 2-1. 해수온 상승 심각성 인식도 데이터 전처리
    severity_map = {
        5: '매우 심각',
        4: '심각',
        3: '보통',
        2: '심각하지 않음',
        1: '심각하지 않음'
    }
    df_survey_data = df_raw_survey['2. 해수온 상승이 삶의 영향에 얼마나 미치는지 아시나요?'].map(severity_map).value_counts().reset_index()
    df_survey_data.columns = ['항목', '응답자수']
    
    # 2-2. 해결 방안 데이터 전처리
    solutions = df_raw_survey['4. 일상생활 속에서 실천할 수 있는 해결 방안은 무엇이라고 생각하시나요?'].dropna()
    solution_list = []
    for s in solutions:
        parts = s.split(',')
        cleaned_parts = [p.strip() for p in parts if p.strip() and p.strip() != '꿀꿀']
        solution_list.extend(cleaned_parts)
    
    solution_counts = pd.Series(solution_list).value_counts().reset_index()
    solution_counts.columns = ['항목', '응답자수']
    
    # 3. 양식업 생산량 데이터
    df_aquaculture = pd.read_csv(io.StringIO(aquaculture_data_text))
    df_aquaculture_melted = df_aquaculture.drop(columns=['증감률(%)']).melt(
        id_vars='어종',
        var_name='연도',
        value_name='생산량(톤)'
    )
    df_aquaculture_melted['연도'] = df_aquaculture_melted['연도'].str.replace(r'\(A\)|\(B\)', '', regex=True)
    df_aquaculture_melted['연도'] = df_aquaculture_melted['연도'].astype(int)

    st.success("데이터 로드 성공! 모든 데이터를 통합 보고서로 준비했습니다.")
    return df_temp_public_yearly, df_survey_data, solution_counts, df_aquaculture_melted

# 모든 데이터 로드
df_temp_public_yearly, df_survey, df_solution, df_aquaculture_melted = load_data()

# ---- 메인 대시보드 UI 시작 ----

st.title("🌊 해수온 변화 통합 보고서")
st.markdown("<p style='text-align: center;'>기후 변화의 주요 지표인 해수온 상승과 우리의 대응 방안을 한눈에 살펴보세요.</p>", unsafe_allow_html=True)
st.markdown("---")

# 1. 해수면 및 지표면 기온 이상값 변화 (사용자 기간 조절 기능 추가)
with st.container(border=True):
    st.subheader("1. 전 지구 기온 이상값 변화: 바다가 보내는 경고 신호")
    st.markdown("""
    <p>전 지구 해수면과 지표면의 기온 이상값(평년 대비 기온 차이)을 통해 지구 온난화 추세를 직관적으로 확인할 수 있습니다. 데이터는 Berkeley Earth의 공신력 있는 자료를 기반으로 합니다.</p>
    """, unsafe_allow_html=True)

min_year = int(df_temp_public_yearly['year'].min())
max_year = int(df_temp_public_yearly['year'].max())

# 기간 조절 슬라이더
year_range = st.slider(
    '연도별 데이터 범위를 선택하세요.',
    min_value=min_year,
    max_value=max_year,
    value=(min_year, max_year)
)

# 선택된 기간에 따라 데이터 필터링
filtered_df_public = df_temp_public_yearly[(df_temp_public_yearly['year'] >= year_range[0]) & (df_temp_public_yearly['year'] <= year_range[1])]

col_temp1, col_temp2 = st.columns(2)

# 1.1 해수면 기온 이상값 그래프
with col_temp1:
    st.markdown("#### 해수면 기온 이상값 변화")
    fig_sea_temp = px.line(filtered_df_public, x='year', y='sea_anomaly',
                            labels={'year': '연도', 'sea_anomaly': '해수면 기온 이상값 (°C)'},
                            color_discrete_sequence=['#42A5F5'])

    fig_sea_temp.update_layout(
        plot_bgcolor='rgba(0,0,0,0)',
        paper_bgcolor='rgba(0,0,0,0)',
        font=dict(family='Pretendard'),
        yaxis_zeroline=True,
        yaxis_zerolinecolor='#FF6347',
        yaxis_zerolinewidth=2,
        title_font_size=16,
        xaxis_showgrid=False,
        yaxis_showgrid=True,
        yaxis_gridcolor='rgba(128,128,128,0.3)'
    )
    st.plotly_chart(fig_sea_temp, use_container_width=True)

# 1.2 지표면 기온 이상값 그래프
with col_temp2:
    st.markdown("#### 지표면 기온 이상값 변화")
    fig_land_temp = px.line(filtered_df_public, x='year', y='land_anomaly',
                            labels={'year': '연도', 'land_anomaly': '지표면 기온 이상값 (°C)'},
                            color_discrete_sequence=['#FF4B4B'])

    fig_land_temp.update_layout(
        plot_bgcolor='rgba(0,0,0,0)',
        paper_bgcolor='rgba(0,0,0,0)',
        font=dict(family='Pretendard'),
        yaxis_zeroline=True,
        yaxis_zerolinecolor='#FF6347',
        yaxis_zerolinewidth=2,
        title_font_size=16,
        xaxis_showgrid=False,
        yaxis_showgrid=True,
        yaxis_gridcolor='rgba(128,128,128,0.3)'
    )
    st.plotly_chart(fig_land_temp, use_container_width=True)


with st.expander("⬇️ 원본 데이터 보기"):
    st.dataframe(filtered_df_public.set_index('year'))
    csv_data = filtered_df_public.to_csv(index=False).encode('utf-8-sig')
    st.download_button(
        label="CSV로 다운로드",
        data=csv_data,
        file_name='global_temperature_anomaly.csv',
        mime='text/csv',
    )

st.markdown("---")

# 2. 해수온 상승 보고서
st.header("2. 해수온 상승 보고서")

with st.container(border=True):
    st.markdown("<h3 style='color:#FF4B4B;'>바다의 온도 경고음: 해수온 상승과 지속 가능한 해결책</h3>", unsafe_allow_html=True)
    st.markdown("""
    <p>최근 기후변화와 더불어 해수온 상승 문제가 전 세계적으로 주목받고 있습니다. 우리 주변에서도 이 문제에 대한 관심이 점차 높아지고 있으며, 청소년 세대 역시 그 심각성을 인식하고 있습니다. 미림마이스터고 학생들을 대상으로 진행한 설문조사 결과, 다수의 학생들이 해수온 상승을 중요한 환경 문제로 인식하고 있었습니다. 이러한 결과는 청소년 스스로 기후위기 문제에 대해 탐구하고 해결책을 고민할 필요성을 보여줍니다. 따라서 본 보고서에서는 해수온 상승의 원인과 그로 인한 문제, 그리고 이를 해결할 수 있는 방안을 제시하고자 합니다.</p>
    """, unsafe_allow_html=True)

    st.markdown("<br>", unsafe_allow_html=True)
    st.markdown("---")
    
    st.markdown("### 본론: 데이터 분석 및 원인 탐구")
    st.markdown("""
    #### 해수온 상승에 따른 변화
    해수온 상승 그래프는 지구 온난화로 인해 해수면 온도가 지속적으로 상승하는 추세를 시각적으로 보여줍니다. 해수온이 상승하면 해수면이 상승하면서 해안 도시가 침수되는 사례도 발생하게 됩니다.
    
    해수온 상승은 우리의 삶에 다양한 위협을 가져오고 있습니다. 바닷물이 따뜻해지면서 태풍의 위력이 강해지고 해양 생태계가 무너져 어획량이 감소하며, 결국 우리의 식량 안보와 경제에도 큰 타격을 주기 때문입니다. 실제로 2016년 호주 대보초에서는 해수온이 급격히 오르면서 전체 산호의 절반 가까이가 백화 현상으로 소멸했고, 한반도 주변 해역에서도 난류성 어종이 늘어 전통적인 어획 구조가 흔들리고 있습니다. 이처럼 해수온 상승은 단순히 바다의 문제가 아니라 인간 사회 전반에 영향을 미치는 심각한 위기이므로, 적극적인 대응과 해결 노력이 필요합니다.
    
    어류 이동 경로의 변화는 해수온 상승이 어업 생산량 감소로 이어지는 중요한 원인입니다. 바닷물이 따뜻해지면 어류는 생존에 적합한 수온을 찾기 위해 기존의 서식지와 이동 경로를 벗어나게 됩니다. 실제로 국립수산과학원 조사에 따르면, 우리나라 동해안에서 잡히던 명태와 같은 냉수성 어종은 급격히 줄어든 반면, 제주도와 남해안에서는 열대·아열대성 어종의 출현 빈도가 크게 증가하였습니다. 따라서 해수온 상승으로 인한 어류 이동 경로 변화는 단순한 생태계 변화가 아니라, 지역 어업 구조와 식량 자원에 직접적인 영향을 미치는 심각한 문제라고 할 수 있습니다.
    
    #### 원인 및 영향 탐구
    해수온 상승의 가장 큰 원인은 인간 활동으로 인한 온실가스 배출입니다. 산업화 이후 화석연료 사용이 급격히 늘어나면서 대기 중 이산화탄소 농도가 증가했고, 이로 인해 지구 온난화가 심화되며 바다 역시 빠르게 따뜻해지고 있습니다. 세계기상기구(WMO)의 보고서에 따르면 지난 50년 동안 해수 표면 온도는 꾸준히 상승하여 2023년에는 관측 이래 가장 높은 수치를 기록했으며, 이는 산업화 이전 대비 약 1.1℃ 이상 높아진 수치입니다. 따라서 해수온 상승은 단순한 자연 현상이 아니라, 인간 활동이 직접적으로 초래한 지구적 위기라 할 수 있습니다.
    """)
    st.markdown("---")

# 2.1. 해수온 상승 심각성 인식 (원 그래프)
st.subheader("2.1. 해수온 상승의 심각성 인식")
col1, col2 = st.columns([1, 1.5])

with col1:
    fig_survey = px.pie(df_survey, values='응답자수', names='항목', title='해수온 상승 심각성 인식도', hole=0.3)
    fig_survey.update_traces(textposition='inside', textinfo='percent+label', marker=dict(colors=px.colors.sequential.Sunset)) # 색상 팔레트 변경
    fig_survey.update_layout(showlegend=False)
    st.plotly_chart(fig_survey, use_container_width=True)

with col2:
    st.markdown("#### 미림마이스터고 학생들의 인식 조사 결과")
    total_severe = df_survey[df_survey['항목'] == '매우 심각']['응답자수'].sum()
    total_count = df_survey['응답자수'].sum()
    percent_severe = (total_severe / total_count) * 100 if total_count > 0 else 0
    st.markdown(f"""
    <div style='background-color:rgba(0,0,0,0); padding:15px; border-radius:10px;'>
        <p>미림마이스터고 학생들을 대상으로 진행한 설문조사 결과, <strong><span style='color:#FF4B4B;'>{percent_severe:.0f}%의 학생들이 해수온 상승을 '매우 심각'한 문제로 인식</span></strong>하고 있는 것으로 나타났습니다. 이는 청소년들이 기후 위기에 대한 높은 관심과 인식을 가지고 있음을 보여줍니다.</p>
    </div>
    """, unsafe_allow_html=True)

st.markdown("---")

# 2.2. 해수온 상승과 생태계 파괴
st.subheader("2.2. 해수온 상승과 해양 생태계 변화")
st.markdown("해수온 상승은 해양 생태계에 직접적인 영향을 미칩니다. 다음 그래프는 국립수산과학원 자료를 기반으로 한 양식 어종 생산량 변화 추이를 보여줍니다.")

fig_aquaculture = px.line(df_aquaculture_melted, x='연도', y='생산량(톤)', color='어종',
                            title='주요 어종별 양식 생산량 변화 (2020-2024)',
                            labels={'연도': '연도', '생산량(톤)': '생산량(톤)', '어종': '어종'},
                            color_discrete_sequence=px.colors.qualitative.Dark24)
fig_aquaculture.update_layout(xaxis=dict(tickmode='linear', dtick=1))
st.plotly_chart(fig_aquaculture, use_container_width=True)

with st.expander("💡 양식업 생산량 변화 분석"):
    st.markdown("""
    - **생태계 파괴 사례:** 해수온 상승은 산호초 백화 현상과 같은 심각한 문제를 야기합니다. 실제로 2016년 호주 대보초에서는 급격한 수온 상승으로 인해 전체 산호의 절반 가까이가 소멸했습니다. 또한, 해수온 변화는 어류의 이동 경로를 바꾸어 어획량 감소와 어업 구조 변화를 초래합니다.
    - **양식업 생산량 변화:** 국립수산과학원 자료에 따르면, 2024년 넙치, 조피볼락과 같은 기존 양식 어종의 생산량은 소폭 증가했지만, **'기타 어종'의 생산량은 전년 대비 22% 이상 크게 증가**했습니다. 이는 해수온 상승으로 인해 전통적인 어종의 생육 환경이 변화하면서 새로운 어종의 양식이 늘어나는 추세를 보여줍니다.
    """)
st.markdown("---")

# 2.3. 해수온 상승 해결 방안 (막대 그래프)
st.subheader("2.3. 해수온 상승 해결 방안")
col3, col4 = st.columns([1.5, 1])

with col3:
    fig_solution = px.bar(df_solution, x='항목', y='응답자수',
               title='해수온 상승 해결 방안 (복수 응답)',
               labels={'항목': '해결 방안', '응답자 수': '응답자 수'},
               color_discrete_sequence=px.colors.qualitative.Plotly) # 색상 팔레트 변경
    st.plotly_chart(fig_solution, use_container_width=True)

with col4:
    st.markdown("#### 학생들이 생각하는 해결책")
    st.markdown("""
    <div style='background-color:rgba(0,0,0,0); padding:15px; border-radius:10px;'>
        <p>학생들은 **일상 속 작은 실천**이 가장 중요하다고 생각하고 있습니다. 대중교통 이용, 일회용품 사용 줄이기, 분리수거와 같은 노력이 해수온 상승 문제 해결에 기여할 수 있습니다.</p>
    </div>
    """, unsafe_allow_html=True)

st.markdown("---")

# 3. 최종 결론
st.header("3. 최종 결론")
st.info("""
해수온 상승은 파리협정과 같은 국제 협약을 통해 국가들이 온실가스 배출량을 줄이고, 맹그로브 숲이나 해초지 복원과 같은 블루카본 사업을 추진할 때 비로소 완화될 수 있습니다. 그러나 정책적 노력만으로는 충분하지 않으며, 학생 개인이 교내 에너지 절약 캠페인에 참여하거나, 지속가능한 수산물을 소비하고, 지역 환경 봉사활동에 참여하는 등의 구체적인 실천을 병행해야 합니다. 미림마고 학생 설문조사에서 나타난 다양한 아이디어까지 보태진다면, 학생들의 작은 행동 하나하나가 기후 위기 대응의 중요한 동력이 될 수 있습니다. 따라서 해수온 상승은 단순한 과학 현상이 아닌 우리 삶과 직결된 문제이며, 공동의 노력이 반드시 요구됩니다.
""")

st.markdown("---")
